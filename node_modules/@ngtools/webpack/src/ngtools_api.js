"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
exports.DEFAULT_ERROR_CODE = 100;
exports.UNKNOWN_ERROR_CODE = 500;
exports.SOURCE = 'angular';
function _error(api, fn) {
    throw new Error('Could not find API ' + api + ', function ' + fn);
}
// Manually check for Compiler CLI availability and supported version.
// This is needed because @ngtools/webpack does not depend directly on @angular/compiler-cli, since
// it is installed as part of global Angular CLI installs and compiler-cli is not of its
// dependencies.
function CompilerCliIsSupported() {
    let version;
    // Check that Angular is available.
    try {
        version = require('@angular/compiler-cli').VERSION;
    }
    catch (e) {
        throw new Error('The "@angular/compiler-cli" package was not properly installed. Error: ' + e);
    }
    // Check that Angular is also not part of this module's node_modules (it should be the project's).
    const compilerCliPath = require.resolve('@angular/compiler-cli');
    if (compilerCliPath.startsWith(path.dirname(__dirname))) {
        throw new Error('The @ngtools/webpack plugin now relies on the project @angular/compiler-cli. '
            + 'Please clean your node_modules and reinstall.');
    }
    // Throw if we're less than 5.x
    if (Number(version.major) < 5) {
        throw new Error('Version of @angular/compiler-cli needs to be 5.0.0 or greater. '
            + `Current version is "${version.full}".`);
    }
}
exports.CompilerCliIsSupported = CompilerCliIsSupported;
// These imports do not exist on a global install for Angular CLI, so we cannot use a static ES6
// import.
let compilerCli = null;
try {
    compilerCli = require('@angular/compiler-cli');
}
catch (_a) {
    // Don't throw an error if the private API does not exist.
    // Instead, the `CompilerCliIsSupported` method should return throw and indicate the
    // plugin cannot be used.
}
exports.VERSION = compilerCli
    && compilerCli.VERSION
    || _error('compiler-cli', 'VERSION');
exports.__NGTOOLS_PRIVATE_API_2 = compilerCli
    && compilerCli.__NGTOOLS_PRIVATE_API_2
    || _error('compiler-cli', '__NGTOOLS_PRIVATE_API_2');
exports.readConfiguration = compilerCli
    && compilerCli.readConfiguration
    || _error('compiler-cli', 'readConfiguration');
// These imports do not exist on Angular versions lower than 5, so we cannot use a static ES6
// import.
let ngtools2 = null;
try {
    ngtools2 = require('@angular/compiler-cli/ngtools2');
}
catch (_b) {
    // Don't throw an error if the private API does not exist.
    // Instead, the `AngularCompilerPlugin.isSupported` method should return false and indicate the
    // plugin cannot be used.
}
exports.createProgram = ngtools2 && ngtools2.createProgram || _error('ngtools2', 'createProgram');
exports.createCompilerHost = ngtools2 && ngtools2.createCompilerHost || _error('ngtools2', 'createCompilerHost');
exports.formatDiagnostics = ngtools2 && ngtools2.formatDiagnostics || _error('ngtools2', 'formatDiagnostics');
exports.EmitFlags = ngtools2 && ngtools2.EmitFlags || _error('ngtools', 'EmitFlags');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd0b29sc19hcGkuanMiLCJzb3VyY2VSb290IjoiLi8iLCJzb3VyY2VzIjpbInBhY2thZ2VzL25ndG9vbHMvd2VicGFjay9zcmMvbmd0b29sc19hcGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFrQkEsNkJBQTZCO0FBR2hCLFFBQUEsa0JBQWtCLEdBQUcsR0FBRyxDQUFDO0FBQ3pCLFFBQUEsa0JBQWtCLEdBQUcsR0FBRyxDQUFDO0FBQ3pCLFFBQUEsTUFBTSxHQUFHLFNBQXNCLENBQUM7QUFRN0MsZ0JBQWdCLEdBQVcsRUFBRSxFQUFVO0lBQ3JDLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLEdBQUcsR0FBRyxHQUFHLGFBQWEsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUNwRSxDQUFDO0FBRUQsc0VBQXNFO0FBQ3RFLG1HQUFtRztBQUNuRyx3RkFBd0Y7QUFDeEYsZ0JBQWdCO0FBQ2hCO0lBQ0UsSUFBSSxPQUFPLENBQUM7SUFFWixtQ0FBbUM7SUFDbkMsSUFBSSxDQUFDO1FBQ0gsT0FBTyxHQUFJLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBZ0IsQ0FBQyxPQUFPLENBQUM7SUFDckUsQ0FBQztJQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDWCxNQUFNLElBQUksS0FBSyxDQUFDLHlFQUF5RSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2pHLENBQUM7SUFFRCxrR0FBa0c7SUFDbEcsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQ2pFLEVBQUUsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RCxNQUFNLElBQUksS0FBSyxDQUFDLCtFQUErRTtjQUMzRiwrQ0FBK0MsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRCwrQkFBK0I7SUFDL0IsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlCLE1BQU0sSUFBSSxLQUFLLENBQUMsaUVBQWlFO2NBQzdFLHVCQUF1QixPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztJQUMvQyxDQUFDO0FBQ0gsQ0FBQztBQXRCRCx3REFzQkM7QUFFRCxnR0FBZ0c7QUFDaEcsVUFBVTtBQUNWLElBQUksV0FBVyxHQUFzQixJQUFJLENBQUM7QUFDMUMsSUFBSSxDQUFDO0lBQ0gsV0FBVyxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2pELENBQUM7QUFBQyxLQUFLLENBQUMsQ0FBQyxJQUFELENBQUM7SUFDUCwwREFBMEQ7SUFDMUQsb0ZBQW9GO0lBQ3BGLHlCQUF5QjtBQUMzQixDQUFDO0FBRVksUUFBQSxPQUFPLEdBQ2xCLFdBQVc7T0FDUixXQUFXLENBQUMsT0FBTztPQUNuQixNQUFNLENBQUMsY0FBYyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQzFCLFFBQUEsdUJBQXVCLEdBQ2xDLFdBQVc7T0FDUixXQUFXLENBQUMsdUJBQXVCO09BQ25DLE1BQU0sQ0FBQyxjQUFjLEVBQUUseUJBQXlCLENBQUMsQ0FBQztBQUMxQyxRQUFBLGlCQUFpQixHQUM1QixXQUFXO09BQ1IsV0FBVyxDQUFDLGlCQUFpQjtPQUM3QixNQUFNLENBQUMsY0FBYyxFQUFFLG1CQUFtQixDQUFDLENBQUM7QUFHakQsNkZBQTZGO0FBQzdGLFVBQVU7QUFDVixJQUFJLFFBQVEsR0FBMEIsSUFBSSxDQUFDO0FBQzNDLElBQUksQ0FBQztJQUNILFFBQVEsR0FBRyxPQUFPLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztBQUN2RCxDQUFDO0FBQUMsS0FBSyxDQUFDLENBQUMsSUFBRCxDQUFDO0lBQ1AsMERBQTBEO0lBQzFELCtGQUErRjtJQUMvRix5QkFBeUI7QUFDM0IsQ0FBQztBQUVZLFFBQUEsYUFBYSxHQUN4QixRQUFRLElBQUksUUFBUSxDQUFDLGFBQWEsSUFBSSxNQUFNLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0FBQy9ELFFBQUEsa0JBQWtCLEdBQzdCLFFBQVEsSUFBSSxRQUFRLENBQUMsa0JBQWtCLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO0FBQ3pFLFFBQUEsaUJBQWlCLEdBQzVCLFFBQVEsSUFBSSxRQUFRLENBQUMsaUJBQWlCLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0FBQ3ZFLFFBQUEsU0FBUyxHQUNwQixRQUFRLElBQUksUUFBUSxDQUFDLFNBQVMsSUFBSSxNQUFNLENBQUMsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuLy8gV2UgZGlzYWJsZSBpbXBsaWNpdCBkZXBlbmRlbmNjaWVzIGJlY2F1c2UgdGhvc2UgYXJlIG9ubHkgZm9yIHR5cGluZ3MgYW5kIGRvbid0IGhhdmUgYSBydW50aW1lXG4vLyBlcXVpdmFsZW50LlxuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWdsb2JhbC10c2xpbnQtZGlzYWJsZVxuLy8gdHNsaW50OmRpc2FibGU6bm8taW1wbGljaXQtZGVwZW5kZW5jaWVzXG4vKipcbiAqIFRoaXMgaXMgYSBjb3B5IG9mIHR5cGVzIGluIEBjb21waWxlci1jbGkvc3JjL25ndG9vbHNfYXBpLmQudHMgZmlsZSxcbiAqIHRvZ2V0aGVyIHdpdGggc2FmZSBpbXBvcnRzIGZvciBwcml2YXRlIGFwaXMgZm9yIGNhc2VzIHdoZXJlIEBhbmd1bGFyL2NvbXBpbGVyLWNsaSBpc24ndFxuICogYXZhaWxhYmxlIG9yIGlzIGJlbG93IHZlcnNpb24gNS5cbiAqL1xuaW1wb3J0ICogYXMgbmdjIGZyb20gJ0Bhbmd1bGFyL2NvbXBpbGVyLWNsaSc7XG5pbXBvcnQgKiBhcyBuZ3Rvb2xzIGZyb20gJ0Bhbmd1bGFyL2NvbXBpbGVyLWNsaS9uZ3Rvb2xzMic7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgdHMgZnJvbSAndHlwZXNjcmlwdCc7XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX0VSUk9SX0NPREUgPSAxMDA7XG5leHBvcnQgY29uc3QgVU5LTk9XTl9FUlJPUl9DT0RFID0gNTAwO1xuZXhwb3J0IGNvbnN0IFNPVVJDRSA9ICdhbmd1bGFyJyBhcyAnYW5ndWxhcic7XG5cbmV4cG9ydCB0eXBlIENvbXBpbGVyT3B0aW9ucyA9IG5nYy5Db21waWxlck9wdGlvbnM7XG5leHBvcnQgdHlwZSBDb21waWxlckhvc3QgPSBuZ3Rvb2xzLkNvbXBpbGVySG9zdDtcbmV4cG9ydCB0eXBlIFByb2dyYW0gPSBuZ3Rvb2xzLlByb2dyYW07XG5leHBvcnQgdHlwZSBEaWFnbm9zdGljID0gbmd0b29scy5EaWFnbm9zdGljO1xuZXhwb3J0IHR5cGUgRGlhZ25vc3RpY3MgPSBSZWFkb25seUFycmF5PHRzLkRpYWdub3N0aWMgfCBEaWFnbm9zdGljPjtcblxuZnVuY3Rpb24gX2Vycm9yKGFwaTogc3RyaW5nLCBmbjogc3RyaW5nKTogbmV2ZXIge1xuICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBmaW5kIEFQSSAnICsgYXBpICsgJywgZnVuY3Rpb24gJyArIGZuKTtcbn1cblxuLy8gTWFudWFsbHkgY2hlY2sgZm9yIENvbXBpbGVyIENMSSBhdmFpbGFiaWxpdHkgYW5kIHN1cHBvcnRlZCB2ZXJzaW9uLlxuLy8gVGhpcyBpcyBuZWVkZWQgYmVjYXVzZSBAbmd0b29scy93ZWJwYWNrIGRvZXMgbm90IGRlcGVuZCBkaXJlY3RseSBvbiBAYW5ndWxhci9jb21waWxlci1jbGksIHNpbmNlXG4vLyBpdCBpcyBpbnN0YWxsZWQgYXMgcGFydCBvZiBnbG9iYWwgQW5ndWxhciBDTEkgaW5zdGFsbHMgYW5kIGNvbXBpbGVyLWNsaSBpcyBub3Qgb2YgaXRzXG4vLyBkZXBlbmRlbmNpZXMuXG5leHBvcnQgZnVuY3Rpb24gQ29tcGlsZXJDbGlJc1N1cHBvcnRlZCgpIHtcbiAgbGV0IHZlcnNpb247XG5cbiAgLy8gQ2hlY2sgdGhhdCBBbmd1bGFyIGlzIGF2YWlsYWJsZS5cbiAgdHJ5IHtcbiAgICB2ZXJzaW9uID0gKHJlcXVpcmUoJ0Bhbmd1bGFyL2NvbXBpbGVyLWNsaScpIGFzIHR5cGVvZiBuZ2MpLlZFUlNJT047XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBcIkBhbmd1bGFyL2NvbXBpbGVyLWNsaVwiIHBhY2thZ2Ugd2FzIG5vdCBwcm9wZXJseSBpbnN0YWxsZWQuIEVycm9yOiAnICsgZSk7XG4gIH1cblxuICAvLyBDaGVjayB0aGF0IEFuZ3VsYXIgaXMgYWxzbyBub3QgcGFydCBvZiB0aGlzIG1vZHVsZSdzIG5vZGVfbW9kdWxlcyAoaXQgc2hvdWxkIGJlIHRoZSBwcm9qZWN0J3MpLlxuICBjb25zdCBjb21waWxlckNsaVBhdGggPSByZXF1aXJlLnJlc29sdmUoJ0Bhbmd1bGFyL2NvbXBpbGVyLWNsaScpO1xuICBpZiAoY29tcGlsZXJDbGlQYXRoLnN0YXJ0c1dpdGgocGF0aC5kaXJuYW1lKF9fZGlybmFtZSkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgQG5ndG9vbHMvd2VicGFjayBwbHVnaW4gbm93IHJlbGllcyBvbiB0aGUgcHJvamVjdCBAYW5ndWxhci9jb21waWxlci1jbGkuICdcbiAgICAgICsgJ1BsZWFzZSBjbGVhbiB5b3VyIG5vZGVfbW9kdWxlcyBhbmQgcmVpbnN0YWxsLicpO1xuICB9XG5cbiAgLy8gVGhyb3cgaWYgd2UncmUgbGVzcyB0aGFuIDUueFxuICBpZiAoTnVtYmVyKHZlcnNpb24ubWFqb3IpIDwgNSkge1xuICAgIHRocm93IG5ldyBFcnJvcignVmVyc2lvbiBvZiBAYW5ndWxhci9jb21waWxlci1jbGkgbmVlZHMgdG8gYmUgNS4wLjAgb3IgZ3JlYXRlci4gJ1xuICAgICAgKyBgQ3VycmVudCB2ZXJzaW9uIGlzIFwiJHt2ZXJzaW9uLmZ1bGx9XCIuYCk7XG4gIH1cbn1cblxuLy8gVGhlc2UgaW1wb3J0cyBkbyBub3QgZXhpc3Qgb24gYSBnbG9iYWwgaW5zdGFsbCBmb3IgQW5ndWxhciBDTEksIHNvIHdlIGNhbm5vdCB1c2UgYSBzdGF0aWMgRVM2XG4vLyBpbXBvcnQuXG5sZXQgY29tcGlsZXJDbGk6IHR5cGVvZiBuZ2MgfCBudWxsID0gbnVsbDtcbnRyeSB7XG4gIGNvbXBpbGVyQ2xpID0gcmVxdWlyZSgnQGFuZ3VsYXIvY29tcGlsZXItY2xpJyk7XG59IGNhdGNoIHtcbiAgLy8gRG9uJ3QgdGhyb3cgYW4gZXJyb3IgaWYgdGhlIHByaXZhdGUgQVBJIGRvZXMgbm90IGV4aXN0LlxuICAvLyBJbnN0ZWFkLCB0aGUgYENvbXBpbGVyQ2xpSXNTdXBwb3J0ZWRgIG1ldGhvZCBzaG91bGQgcmV0dXJuIHRocm93IGFuZCBpbmRpY2F0ZSB0aGVcbiAgLy8gcGx1Z2luIGNhbm5vdCBiZSB1c2VkLlxufVxuXG5leHBvcnQgY29uc3QgVkVSU0lPTjogdHlwZW9mIG5nYy5WRVJTSU9OID1cbiAgY29tcGlsZXJDbGlcbiAgJiYgY29tcGlsZXJDbGkuVkVSU0lPTlxuICB8fCBfZXJyb3IoJ2NvbXBpbGVyLWNsaScsICdWRVJTSU9OJyk7XG5leHBvcnQgY29uc3QgX19OR1RPT0xTX1BSSVZBVEVfQVBJXzI6IHR5cGVvZiBuZ2MuX19OR1RPT0xTX1BSSVZBVEVfQVBJXzIgPVxuICBjb21waWxlckNsaVxuICAmJiBjb21waWxlckNsaS5fX05HVE9PTFNfUFJJVkFURV9BUElfMlxuICB8fCBfZXJyb3IoJ2NvbXBpbGVyLWNsaScsICdfX05HVE9PTFNfUFJJVkFURV9BUElfMicpO1xuZXhwb3J0IGNvbnN0IHJlYWRDb25maWd1cmF0aW9uOiB0eXBlb2YgbmdjLnJlYWRDb25maWd1cmF0aW9uID1cbiAgY29tcGlsZXJDbGlcbiAgJiYgY29tcGlsZXJDbGkucmVhZENvbmZpZ3VyYXRpb25cbiAgfHwgX2Vycm9yKCdjb21waWxlci1jbGknLCAncmVhZENvbmZpZ3VyYXRpb24nKTtcblxuXG4vLyBUaGVzZSBpbXBvcnRzIGRvIG5vdCBleGlzdCBvbiBBbmd1bGFyIHZlcnNpb25zIGxvd2VyIHRoYW4gNSwgc28gd2UgY2Fubm90IHVzZSBhIHN0YXRpYyBFUzZcbi8vIGltcG9ydC5cbmxldCBuZ3Rvb2xzMjogdHlwZW9mIG5ndG9vbHMgfCBudWxsID0gbnVsbDtcbnRyeSB7XG4gIG5ndG9vbHMyID0gcmVxdWlyZSgnQGFuZ3VsYXIvY29tcGlsZXItY2xpL25ndG9vbHMyJyk7XG59IGNhdGNoIHtcbiAgLy8gRG9uJ3QgdGhyb3cgYW4gZXJyb3IgaWYgdGhlIHByaXZhdGUgQVBJIGRvZXMgbm90IGV4aXN0LlxuICAvLyBJbnN0ZWFkLCB0aGUgYEFuZ3VsYXJDb21waWxlclBsdWdpbi5pc1N1cHBvcnRlZGAgbWV0aG9kIHNob3VsZCByZXR1cm4gZmFsc2UgYW5kIGluZGljYXRlIHRoZVxuICAvLyBwbHVnaW4gY2Fubm90IGJlIHVzZWQuXG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVQcm9ncmFtOiB0eXBlb2Ygbmd0b29scy5jcmVhdGVQcm9ncmFtID1cbiAgbmd0b29sczIgJiYgbmd0b29sczIuY3JlYXRlUHJvZ3JhbSB8fCBfZXJyb3IoJ25ndG9vbHMyJywgJ2NyZWF0ZVByb2dyYW0nKTtcbmV4cG9ydCBjb25zdCBjcmVhdGVDb21waWxlckhvc3Q6IHR5cGVvZiBuZ3Rvb2xzLmNyZWF0ZUNvbXBpbGVySG9zdCA9XG4gIG5ndG9vbHMyICYmIG5ndG9vbHMyLmNyZWF0ZUNvbXBpbGVySG9zdCB8fCBfZXJyb3IoJ25ndG9vbHMyJywgJ2NyZWF0ZUNvbXBpbGVySG9zdCcpO1xuZXhwb3J0IGNvbnN0IGZvcm1hdERpYWdub3N0aWNzOiB0eXBlb2Ygbmd0b29scy5mb3JtYXREaWFnbm9zdGljcyA9XG4gIG5ndG9vbHMyICYmIG5ndG9vbHMyLmZvcm1hdERpYWdub3N0aWNzIHx8IF9lcnJvcignbmd0b29sczInLCAnZm9ybWF0RGlhZ25vc3RpY3MnKTtcbmV4cG9ydCBjb25zdCBFbWl0RmxhZ3M6IHR5cGVvZiBuZ3Rvb2xzLkVtaXRGbGFncyA9XG4gIG5ndG9vbHMyICYmIG5ndG9vbHMyLkVtaXRGbGFncyB8fCBfZXJyb3IoJ25ndG9vbHMnLCAnRW1pdEZsYWdzJyk7XG4iXX0=